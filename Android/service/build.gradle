apply from: 'generator.gradle'
apply plugin: 'com.android.library'

android {
    compileSdkVersion compileSdk

    defaultConfig {
        minSdkVersion minSdk
        targetSdkVersion targetSdk//keep it below M, tests+permission don't work

        versionCode 1
        versionName "1.0"
        if (groovyEnabled) {
            multiDexEnabled true
        }
    }
    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
        }
    }
    android {
        lintOptions {
            abortOnError false
        }
    }

    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }
}

task buildHelpClass {
    doFirst {
        try {
            def fsep = System.getProperty("file.separator")
            def srcFolder = new File(String.format("%s/src/main/java", getProjectDir().absolutePath).replace("/", fsep))
            if (!srcFolder.exists()) {
                throw new TaskExecutionException(task(name), new Throwable(String.format("'%s' not found!", srcFolder.getAbsolutePath())));
            }
            def classContent = generateHelpClass(srcFolder.absolutePath)
            def classFile = new File(String.format("%s/src/main/java/com/scurab/android/anuitor/reflect/ReflectionHelper.java", getProjectDir().absolutePath).replace("/", fsep))
            classFile.delete()
            classFile.write(classContent, "utf-8")
        } catch (Throwable t) {
            throw new TaskExecutionException(task(name), t)
        }
    }
}

preBuild.dependsOn buildHelpClass

dependencies {
    testImplementation 'junit:junit:4.12'

    compileOnly "androidx.legacy:legacy-support-core-ui:${androidX}"
    compileOnly "androidx.fragment:fragment:${androidX}"
    compileOnly "androidx.recyclerview:recyclerview:${androidX}"
    compileOnly "androidx.cardview:cardview:${androidX}"
    compileOnly "androidx.gridlayout:gridlayout:${androidX}"
    compileOnly "androidx.percentlayout:percentlayout:${androidX}"
    compileOnly "com.google.android.material:material:${androidX}"

    compileOnly "com.google.code.gson:gson:${gson}"
    compileOnly "com.fasterxml.jackson.core:jackson-databind:${jackson}"
    compileOnly "com.google.android.tools:dx:${dx}"
    compileOnly "org.codehaus.groovy:groovy:${groovy}"

    //androidTest only, not needed for the lib itself
    testImplementation "com.google.code.gson:gson:${gson}"
    testImplementation "commons-io:commons-io:${commonsIo}"
    testImplementation "org.robolectric:robolectric:${robolectric}"
    testImplementation "org.mockito:mockito-core:${mockito}"
    androidTestImplementation "org.mockito:mockito-core:${mockito}"
}